CREATE TABLE "mytable" (
  "------------------Inserty-------------------" text
);

INSERT INTO "mytable" ("------------------Inserty-------------------")
VALUES
('TRUNCATE sessions_trainers'),
('bookings'),
('RESTART IDENTITY CASCADE;'),
('-- 1) Pola treningowe'),
('INSERT INTO training_fields (f_difficulty_level'),
('SELECT (1 + (g%5))::int'),
('FROM generate_series(1'),
('-- 2) Sprzęt (modele łuków)'),
('INSERT INTO equipment (b_model'),
('SELECT'),
('''Model-'' || g'),
('(CASE WHEN g%2=0 THEN (30 + (g%20))::text || ''LBS'' ELSE (35 + (g%25))::text || ''LBS'' END)'),
('(CASE WHEN g%3=0 THEN (58 + (g%5))::text || ''"'' ELSE (60 + (g%6))::text || ''"'' END)'),
('FROM generate_series(1'),
('-- 3) Członkowie klubu (~250). Email bywa NULL. Telefon unikalny.'),
('INSERT INTO club_members (m_name'),
('SELECT'),
('''Imię'' || g'),
('''Nazwisko'' || g'),
('CASE WHEN random() < 0.65 THEN ''user'' || g || ''@example2.com'' ELSE NULL END'),
('(500000000 + 556153*g)::text'),
('FROM generate_series(1'),
('UPDATE club_members'),
('SET m_last_active ='),
('timestamptz ''2025-01-01'''),
('+ ( (1 - power(random()'),
('-- 4) Trenerzy (12 osób) – jako podtypy członków: pierwsi 12 członków stają się trenerami'),
('INSERT INTO trainers (member_id'),
('SELECT member_id'),
('FROM club_members'),
('WHERE member_id <= 24'),
('ORDER BY member_id;'),
('-- 5) Sesje (~120) – 30 dni x 4 sesje/dzień (po polach rotacyjnie)'),
('WITH days AS ('),
('SELECT generate_series(date_trunc(''day'''),
('date_trunc(''day'''),
('interval ''1 day'') AS d'),
(')'),
('slots AS ('),
('SELECT d.d + (s*interval ''3 hour'') AS starts_at'),
('FROM days d'),
(')'),
('fields AS ('),
('SELECT field_id FROM training_fields ORDER BY field_id'),
(')'),
('plan AS ('),
('SELECT'),
('row_number() over () AS rn'),
('f.field_id'),
('s.starts_at'),
('FROM fields f'),
('CROSS JOIN slots s'),
(')'),
('picked AS ('),
('SELECT field_id'),
('FROM plan'),
('WHERE (rn % 2) = 0   -- połowę slotów "aktywujemy"'),
(')'),
('INSERT INTO sessions (field_id'),
('SELECT field_id'),
('FROM picked'),
('ORDER BY starts_at;'),
('-- 6) Rezerwacje (~800): część bez sesji (pending)'),
('WITH m AS ('),
('SELECT member_id FROM club_members'),
(')'),
('s AS ('),
('SELECT session_id'),
(')'),
('rand_s AS ('),
('SELECT m.member_id'),
('(SELECT session_id FROM s ORDER BY random() LIMIT 1) AS session_id'),
('(SELECT field_id FROM training_fields ORDER BY random() LIMIT 1) AS pref_field'),
('FROM m'),
('LIMIT 800'),
(')'),
('INSERT INTO bookings (member_id'),
('SELECT'),
('member_id'),
('CASE WHEN random() < 0.7 THEN session_id ELSE NULL END'),
('CASE WHEN random() < 0.5 THEN pref_field ELSE NULL END'),
('(SELECT status_id FROM reservation_statuses ORDER BY random() LIMIT 1)'),
('now() - ((random()*10)::int || '' days'')::interval'),
('FROM rand_s;'),
('-- 7) Pozycje sprzętu w rezerwacjach (wariant B: model + ilość; 1–3 pozycji/booking)'),
('WITH b AS ('),
('SELECT booking_id FROM bookings'),
(')'),
('e AS ('),
('SELECT bow_id FROM equipment'),
(')'),
('INSERT INTO booking_equipment (booking_id'),
('SELECT'),
('b.booking_id'),
('e.bow_id'),
('(1 + (random()*3)::int) AS be_quantity'),
('FROM b'),
('JOIN e ON random() < 0.10   -- ok. 10% szansy'),
('WHERE random() < 0.9        -- ok. 90% rezerwacji ma jakiś sprzęt'),
('ON CONFLICT DO NOTHING;'),
('-- 8) Płatności (1:N do bookings): ~80% bookingów ma >=1 płatność (czasem dwie)'),
('WITH b AS ('),
('SELECT booking_id FROM bookings'),
(')'),
('p AS ('),
('SELECT'),
('booking_id'),
('round((50 + random()*150)::numeric'),
('round((20 + random()* 80)::numeric'),
('(SELECT method_id   FROM payment_methods   ORDER BY random() LIMIT 1) AS method1'),
('(SELECT currency_id FROM currencies        ORDER BY random() LIMIT 1) AS curr1'),
('(SELECT status_id   FROM payment_statuses  ORDER BY random() LIMIT 1) AS status1'),
('now() - ((random()*5)::int || '' days'')::interval AS dt1'),
('FROM b'),
('WHERE random() < 0.8'),
(')'),
('INSERT INTO payments (booking_id'),
('SELECT booking_id'),
('-- Druga płatność dla ~10% (np. dopłata/zwrot)'),
('INSERT INTO payments (booking_id'),
('SELECT booking_id'),
('round((10 + random()*50)::numeric'),
('now() - ((random()*3)::int || '' days'')::interval'),
('(SELECT method_id   FROM payment_methods   ORDER BY random() LIMIT 1)'),
('(SELECT currency_id FROM currencies        ORDER BY random() LIMIT 1)'),
('(SELECT status_id   FROM payment_statuses  ORDER BY random() LIMIT 1)'),
('FROM bookings'),
('WHERE random() < 0.10;'),
('-- 9) Przypisania trenerów do sesji: 1–2 trenerów/sesję'),
('-- 1) Zmaterializuj losowanie do tymczasowej tabeli (na czas transakcji)'),
('CREATE TEMP TABLE tmp_bucketed ON COMMIT DROP AS'),
('SELECT'),
('s.session_id'),
('r'),
('CASE'),
('WHEN r < 0.20 THEN ''zero'''),
('WHEN r < 0.80 THEN ''one'''),
('ELSE ''two'''),
('END AS bucket'),
('FROM sessions s'),
('CROSS JOIN LATERAL (SELECT random() AS r) z;'),
('-- 2) ~60% sesji z 1 trenerem'),
('INSERT INTO sessions_trainers (session_id'),
('SELECT'),
('b.session_id'),
('t_pick.trainer_id'),
('CASE WHEN random() < 0.5 THEN ''lead'' ELSE ''assistant'' END AS st_role'),
('now() - ((random()*7)::int || '' days'')::interval AS st_assigned_at'),
('FROM tmp_bucketed b'),
('JOIN LATERAL ('),
('SELECT t.trainer_id'),
('FROM trainers t'),
('ORDER BY md5(t.trainer_id::text || b.session_id::text)  -- „tasowanie” per sesja'),
('LIMIT 1'),
(') AS t_pick ON TRUE'),
('WHERE b.bucket = ''one'''),
('ON CONFLICT DO NOTHING;'),
('-- 3) ~20% sesji z 2 różnymi trenerami'),
('INSERT INTO sessions_trainers (session_id'),
('SELECT'),
('b.session_id'),
('t_pick.trainer_id'),
('CASE WHEN t_pick.rn = 1 THEN ''lead'' ELSE ''assistant'' END AS st_role'),
('now() - ((random()*7)::int || '' days'')::interval AS st_assigned_at'),
('FROM tmp_bucketed b'),
('JOIN LATERAL ('),
('SELECT t.trainer_id'),
('row_number() OVER (ORDER BY md5(t.trainer_id::text || b.session_id::text)) AS rn'),
('FROM trainers t'),
(') AS t_pick ON t_pick.rn <= 2'),
('WHERE b.bucket = ''two'''),
('ON CONFLICT DO NOTHING;'),
('-- 10) Wyniki'),
('INSERT INTO scores (member_id'),
('SELECT member_id'),
('FROM club_members'),
('WHERE random() < 0.6;');
